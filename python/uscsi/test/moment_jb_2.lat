# Beam envelope simulation.

#sim_type = "TransferMatrix";
sim_type = "MomentMatrix";

# Global parameters.

AMU = 931.49432e6; # Atomic mass unit [eV/c^2].

IonZ  = 33.0/238.0;    # Charge state for U_238.
IonEs = AMU;           # Nucleon mass [eV/u].
IonEk = 0.5e6;         # Kinetic energy at LS1 entrance [eV/u].
IonW  = IonEs + IonEk; # Total energy [eV/u].

# Define Initial Conditions for the Charge States.

ionChargeStates = [33.0/238.0, 34.0/238.0];

#chargeAmount    = [10111.0, 10531.0];

# Define phase-space coordinates.
# Units are: [mm, rad, mm, rad, rad, MeV/u]

BaryCenter = [-0.0007886, 1.08371e-05, 0.01337343, 6.678534e-06, -0.0001847729, 0.000309995];

#BaryCenter = [0.007312667, 1.476565e-05, 0.003449849, -7.39768469e-06, 0.02297886, 0.0020601];

# Define beam envelope parameters.
# Units are: [mm, rad, mm, rad, rad, MeV/u]

S: source, initial = [
  2.76309450173216,     -0.000428247336601120,  0.0158178569170548,    2.15594190999033e-05,  0.000186380506020608, -2.99394486972954e-05,
 -0.000428247336601120,  3.84946606786835e-06, -1.38385440065569e-06, -1.85409877831153e-08,  1.06777952235670e-07,  5.28564015969982e-09,
  0.0158178569170548,   -1.38385440065569e-06,  2.36251225995801,     -0.000669320459982719, -0.000580099938581586,  6.71651534058884e-06,
  2.15594190999033e-05, -1.85409877831153e-08, -0.000669320459982719,  4.89711389179344e-06, -5.01614882231616e-07,  5.57484221804692e-08,
  0.000186380506020608,  1.06777952235670e-07, -0.000580099938581586, -5.01614882231616e-07,  0.000671687184532941, -1.23223341528590e-05,
 -2.99394486972954e-05,  5.28564015969982e-09,  6.71651534058884e-06,  5.57484221804692e-08,  -1.23223341528590e-05, 1.99524668993273e-06
];

S2 = [
  2.79323844382261,      0.000887286204468529, -0.0207965183919297,   -4.63190902866223e-05,  0.000779644086677272, -1.21652649506989e-05,
  0.000887286204468529,  4.27685827324966e-06,  1.93639661427031e-05, -2.61322448516117e-08,  5.42676597149308e-07, -8.66937527683823e-09,
 -0.0207965183919297,    1.93639661427031e-05,  2.71701903011773,      0.00111147531913367,  -0.00103788236242888,  -2.45363150807461e-06,
 -4.63190902866223e-05, -2.61322448516117e-08,  0.00111147531913367,   4.43238453519665e-06, -1.07153756021073e-06, -7.65104963052334e-09,
  0.000779644086677272,  5.42676597149308e-07, -0.00103788236242888,  -1.07153756021073e-06,  0.00110483747345619,   1.16863446546579e-05,
 -1.21652649506989e-05, -8.66937527683823e-09, -2.45363150807461e-06, -7.65104963052334e-09,  1.16863446546579e-05,  1.74197553089731e-06
];

# Default.
S3: source, initial = [
 1.0,  0,   0,   0,   0,   0,
  0,  1.0,  0,   0,   0,   0,
  0,   0,  1.0,  0,   0,   0,
  0,   0,   0,  1.0,  0,   0,
  0,   0,   0,   0,  1.0,  0,
  0,   0,   0,   0,   0,  1.0
];

drift_1: drift, L = 0.072000, aper = 0.020000;
drift_2: drift, L = 0.135064, aper = 0.020000;
ls1_ca01_cav1_d1127: rfcavity, cavtype = "0.041QWR", L = 0.240000, f = 80.500000e6,
  phi = -35.000000, scl_fac = 0.640000, aper = 0.017000;
drift_3: drift, L = 0.064263, aper = 0.020000;
ls1_ca01_bpm_d1129_1: marker;
drift_4: drift, L = 0.055880, aper = 0.020000;
drift_5: drift, L = 0.076123, aper = 0.020000;
ls1_ca01_sol1_d1131_1: solenoid, L = 0.100000, B = 5.340000, K = 0.0, aper = 0.020000;
ls1_ca01_dch_d1131_2: marker, L = 0.0;
ls1_ca01_dcv_d1131_3: marker;
ls1_ca01_sol1_d1131_2: solenoid, L = 0.100000, B = 5.340000, K = 0.0, aper = 0.020000;
drift_6: drift, L = 0.076123, aper = 0.020000;
drift_7: drift, L = 0.067270, aper = 0.020000;
ls1_ca01_cav2_d1135: rfcavity, cavtype = "0.041QWR", L = 0.240000, f = 80.500000e6,
  phi = -35.000000, scl_fac = 0.700000, aper = 0.017000;

# cell: LINE = (
#   S, drift_1, drift_2, ls1_ca01_cav1_d1127, drift_3, ls1_ca01_bpm_d1129_1,
#   drift_4, drift_5, ls1_ca01_sol1_d1131_1, ls1_ca01_dch_d1131_2,
#   ls1_ca01_dcv_d1131_3, ls1_ca01_sol1_d1131_2, drift_6, drift_7,
#   ls1_ca01_cav2_d1135
# );

cell: LINE = (S, drift_1, drift_2, ls1_ca01_cav1_d1127);

USE: cell;
